package project.editor.value;

import js.jquery.JQuery;
import project.data.value.FilepathValueTemplate;
import util.Fields;

class FilepathValueTemplateEditor extends ValueTemplateEditor
{
	public var defaultField:JQuery;
	public var extensionsField:JQuery;
	public var rootField: JQuery;

	override function importInto(into:JQuery)
	{
		var pathTemplate:FilepathValueTemplate = cast template;

		// default val
		var fileExtensions = pathTemplate.extensions.length == 0 ? [] : [{name: "Allowed extensions", extensions: pathTemplate.extensions}];
		defaultField = Fields.createFilepathData(pathTemplate.defaults, fileExtensions);
		Fields.createSettingsBlock(into, defaultField, SettingsBlock.Half, "Default", SettingsBlock.InlineTitle);

		var extensions = "";
		for (i in 0...pathTemplate.extensions.length) extensions += (i > 0 ? "\n" : "") + pathTemplate.extensions[i];

		// extensions
		extensionsField = Fields.createTextarea("...", extensions);
		Fields.createSettingsBlock(into, extensionsField, SettingsBlock.Full, "Allowed extensions (one per line)");
		extensionsField.on("input propertychange", function (e) { // Need to update extensions for default val picker
			save();
			fileExtensions.splice(0, fileExtensions.length);
			if (pathTemplate.extensions.length > 0)
				fileExtensions.push({name: "Allowed extensions", extensions: pathTemplate.extensions});
		});

		// roots
		rootField = Fields.createTextarea("...", extensions);
		Fields.createSettingsBlock(into, rootField, SettingsBlock.Full, "File Relative Roots (one per line)");
		rootField.on("input propertychange", function (e) { // Need to update extensions for default val picker
			save();
			fileExtensions.splice(0, fileExtensions.length);
			if (pathTemplate.extensions.length > 0)
				fileExtensions.push({name: "All Roots", extensions: pathTemplate.roots});
		});
	}

	override function save()
	{
		var pathTemplate:FilepathValueTemplate = cast template;

		pathTemplate.defaults = Fields.getFilepathData(defaultField);

		var extensions = StringTools.trim(Fields.getField(extensionsField));
		if (extensions.length == 0)
			pathTemplate.extensions = [];
		else
			pathTemplate.extensions = extensions.split("\n");

		var roots = StringTools.trim(Fields.getField(rootField));
		if (roots.length == 0) {
			pathTemplate.roots = [];
		}
		else {
			pathTemplate.extensions = roots.split("\n");
		}
	}
}
